#undef NDEBUG
#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "agb/config.h"
#include "agb/glyph_margins.h"
#include "glyph.h"

static void test_wrap(char* str, char* wrapped) {
    char* cpy = strdup(str);

    hard_wrap_sjis(cpy);
    // fprintf(stderr, "%s\n", cpy);
    assert(!strcmp(cpy, wrapped));
    free(cpy);
}

static char long_line_cyr[] = {0x84, 0x51, 0x84, 0x70, 0x84, 0x71, 0x84, 0x80, 0x84, 0x84, 0x84, 0x70, 0x20, 0x84, 0x85, 0x20, 0x84, 0x7D, 0x84, 0x75, 0x84, 0x7E, 0x84, 0x91, 0x20, 0x84, 0x7E, 0x84, 0x75, 0x0A, 0x84, 0x82, 0x84, 0x70, 0x84, 0x83, 0x84, 0x81, 0x84, 0x80, 0x84, 0x7C, 0x84, 0x70, 0x84, 0x73, 0x84, 0x70, 0x84, 0x90, 0x84, 0x8B,
    0x84, 0x70, 0x84, 0x91, 0x20, 0x84, 0x7B, 0x20, 0x84, 0x89, 0x84, 0x70, 0x84, 0x83, 0x84, 0x84, 0x84, 0x80, 0x84, 0x7D, 0x84, 0x85, 0x0A, 0x84, 0x80, 0x84, 0x71, 0x84, 0x8B, 0x84, 0x75, 0x84, 0x7E, 0x84, 0x79, 0x84, 0x90, 0x20, 0x84, 0x83, 0x20, 0x84, 0x7C, 0x84, 0x90, 0x84, 0x74, 0x84, 0x8E, 0x84, 0x7D, 0x84,
    0x79, 0x2C, 0x20, 0x84, 0x81, 0x84, 0x80, 0x84, 0x84, 0x84, 0x80, 0x84, 0x7D, 0x84, 0x85, 0x0A, 0x84, 0x59, 0x84, 0x75, 0x84, 0x82, 0x84, 0x79, 0x84, 0x7C, 0x20, 0x84, 0x7D, 0x84, 0x7E, 0x84, 0x75, 0x20, 0x84, 0x80, 0x84, 0x83, 0x84, 0x80, 0x84, 0x71, 0x84, 0x75, 0x84, 0x7E, 0x84, 0x7E, 0x84, 0x80, 0x0A, 0x84,
    0x74, 0x84, 0x80, 0x84, 0x82, 0x84, 0x80, 0x84, 0x73, 0x84, 0x70, 0x2E, 0x20, 0x84, 0x4F, 0x84, 0x7E, 0x84, 0x70, 0x20, 0x84, 0x74, 0x84, 0x80, 0x84, 0x7C, 0x84, 0x73, 0x84, 0x80, 0x20, 0x84, 0x79, 0x20, 0x84, 0x83, 0x0A, 0x84, 0x7E, 0x84, 0x75, 0x84, 0x84, 0x84, 0x75, 0x84, 0x82, 0x84, 0x81, 0x84, 0x75, 0x84,
    0x7E, 0x84, 0x79, 0x84, 0x75, 0x84, 0x7D, 0x20, 0x84, 0x77, 0x84, 0x74, 0x84, 0x70, 0x84, 0x7C, 0x84, 0x70, 0x20, 0x84, 0x8F, 0x84, 0x84, 0x84, 0x80, 0x84, 0x7A, 0x0A, 0x84, 0x81, 0x84, 0x80, 0x84, 0x75, 0x84, 0x78, 0x84, 0x74, 0x84, 0x7B, 0x84, 0x79, 0x2E, 0x00 };

int main() {
    static struct {
        char* str, * wrapped;
    } cases[] = {
        {
            "The quick brown fox jumps over the lazy dog",
            "The quick brown fox jumps\nover the lazy dog"
        },
        {
            "Text with spaces",
            "Text with spaces"
        },
        {
            "Lorem ipsum dolor sit amet, consectetur adipisici elit, sed do eiusmod tempor "
            "incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, qui",
            "Lorem ipsum dolor sit amet,\nconsectetur adipisici elit,\nsed do eiusmod tempor\n"
            "incididunt ut labore et\ndolore magna aliqua. Ut\nenim ad minim veniam, qui"
        },
        {
            "Lorem ipsum dolor sit amet,\nconsectetur adipisici elit,\nsed do eiusmod tempor\n"
            "incididunt ut labore et\ndolore magna aliqua. Ut\nenim ad minim veniam, qui",
            "Lorem ipsum dolor sit amet,\nconsectetur adipisici elit,\nsed do eiusmod tempor\n"
            "incididunt ut labore et\ndolore magna aliqua. Ut\nenim ad minim veniam, qui"
        },
        {
            long_line_cyr,
            long_line_cyr
        }
    };

    for (size_t i = 0; i < sizeof(cases) / sizeof(*cases); i++)
        test_wrap(cases[i].str, cases[i].wrapped);
}
